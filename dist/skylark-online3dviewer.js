/**
 * skylark-online3dviewer - A version of online3dviewer that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-online3dviewer/
 * @license MIT
 */
!function(t,e){var i=e.define,require=e.require,n="function"==typeof i&&i.amd,o=!n&&"undefined"!=typeof exports;if(!n&&!i){var s={};i=e.define=function(t,e,i){"function"==typeof i?(s[t]={factory:i,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var i=e.split("/"),n=t.split("/");i.pop();for(var o=0;o<n.length;o++)"."!=n[o]&&(".."==n[o]?i.pop():i.push(n[o]));return i.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):s[t]={factory:null,resolved:!0,exports:i}},require=e.require=function(t){if(!s.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=s[t];if(!module.resolved){var i=[];module.deps.forEach(function(t){i.push(require(t))}),module.exports=module.factory.apply(e,i)||null,module.resolved=!0}return module.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-online3dviewer/InfoTable",["skylark-jquery"],function(t){var e=function(e){this.table=t("<table>").addClass("infotable").appendTo(e)};return e.prototype.AddRow=function(e,i){var n=t("<tr>").appendTo(this.table);t("<td>").html(e).appendTo(n),t("<td>").html(i).appendTo(n)},e.prototype.AddColorRow=function(e,i){var n=t("<tr>").appendTo(this.table);t("<td>").html(e).appendTo(n);var o=document.createElement("td"),o=t("<td>").appendTo(n),s=t("<div>").addClass("colorbutton").appendTo(o);s.attr("title","("+i[0]+", "+i[1]+", "+i[2]+")");for(var r=JSM.RGBComponentsToHexColor(255*i[0],255*i[1],255*i[2]),a=r.toString(16);a.length<6;)a="0"+a;s.css("background","#"+a)},e}),t("skylark-online3dviewer/FloatingControl",["skylark-jquery"],function(t){var e=function(){this.parent=null,this.controlDiv=null,this.contentDiv=null};return e.prototype.Open=function(e){null!==this.controlDiv&&this.Close(),this.parent=e.parent,this.controlDiv=t("<div>").addClass("control").appendTo(t("body")),this.contentDiv=t("<div>").addClass("controlcontent").html(e.text).appendTo(this.controlDiv),this.Resize()},e.prototype.Close=function(){null!==this.controlDiv&&(this.controlDiv.remove(),this.controlDiv=null)},e.prototype.Resize=function(){null!==this.controlDiv&&(this.controlDiv.css("left",this.parent.offset().left+(this.parent.width()-this.controlDiv.width())/2+"px"),this.controlDiv.css("top",this.parent.offset().top+(this.parent.height()-this.controlDiv.height())/3+"px"))},e}),t("skylark-online3dviewer/FloatingDialog",["skylark-jquery"],function(t){var e=function(){this.dialogDiv=null,this.contentDiv=null};return e.prototype.Open=function(e){function i(e,i,n){var o=t("<div>").addClass("dialogbutton").html(n.text).appendTo(i);o.click(function(){n.callback(e)})}null!==this.dialogDiv&&this.Close(),this.dialogDiv=t("<div>").addClass("dialog").appendTo(t("body")),t("<div>").addClass("dialogtitle").html(e.title).appendTo(this.dialogDiv),this.contentDiv=t("<div>").addClass("dialogcontent").appendTo(this.dialogDiv),null!==e.text&&void 0!==e.text&&this.contentDiv.html(e.text);var n,o,s=t("<div>").addClass("dialogbuttons").appendTo(this.dialogDiv);for(n=0;n<e.buttons.length;n++)o=e.buttons[n],i(this,s,o);document.addEventListener("click",this.MouseClick.bind(this),!0),this.Resize()},e.prototype.Close=function(){null!==this.dialogDiv&&(this.dialogDiv.remove(),this.dialogDiv=null,t("body").unbind("click"))},e.prototype.GetContentDiv=function(){return this.contentDiv},e.prototype.Resize=function(){null!==this.dialogDiv&&(this.dialogDiv.css("left",(document.body.clientWidth-this.dialogDiv.width())/2+"px"),this.dialogDiv.css("top",(document.body.clientHeight-this.dialogDiv.height())/3+"px"))},e.prototype.MouseClick=function(t){if(null!==this.dialogDiv){for(var e=!1,i=t.target;null!==i;)i===this.dialogDiv.get()[0]&&(e=!0),i=i.parentElement;e||this.Close()}},e}),t("skylark-online3dviewer/ExtensionInterface",[],function(){var t=function(t){this.app=t};return t.prototype.GetButtonsDiv=function(){return this.app.extensionButtons.GetButtonsDiv()},t.prototype.GetModelJson=function(){return this.app.viewer.GetJsonData()},t}),t("skylark-online3dviewer/ExtensionButtons",["skylark-jquery"],function(t){var e=function(e){this.buttonsDiv=t("<div>").attr("id","extbuttons").appendTo(e)};return e.prototype.GetButtonsDiv=function(){return this.buttonsDiv},e}),t("skylark-online3dviewer/ImporterProgressBar",["skylark-jquery"],function(t){var e=function(t){this.parent=t,this.borderDiv=null,this.contentDiv=null,this.maxCount=null,this.maxWidth=null};return e.prototype.Init=function(e){this.borderDiv=t("<div>").addClass("progressbarborder").appendTo(this.parent),this.contentDiv=t("<div>").addClass("progressbarcontent").appendTo(this.borderDiv),this.maxCount=e,this.maxWidth=this.borderDiv.width(),this.Step(0)},e.prototype.Step=function(t){var e=this.maxWidth/this.maxCount,i=t*e;t==this.maxCount&&(i=this.maxWidth),this.contentDiv.width(i)},e}),t("skylark-online3dviewer/ImporterButtons",["skylark-jquery"],function(t){var e=function(e){this.buttonsDiv=t("<div>").attr("id","buttons").appendTo(e)};return e.prototype.AddLogo=function(e){var i=t("<div>").attr("id","logo").html(e).appendTo(this.buttonsDiv);i.click(function(){location.hash="",location.reload()})},e.prototype.AddButton=function(e,i,n){var o=t("<img>").addClass("topbutton").attr("src",e).attr("title",i).appendTo(this.buttonsDiv);o.click(function(){n()})},e.prototype.AddToggleButton=function(e,i,n,o){var s=t("<img>").addClass("topbutton").attr("src",e).attr("title",n).appendTo(this.buttonsDiv),r=!0;s.click(function(){(r=!r)?s.attr("src",e):s.attr("src",i),o()})},e}),t("skylark-online3dviewer/ImporterMenu",["skylark-jquery","./ImporterProgressBar","./ImporterButtons"],function(t,e,i){function n(t){return void 0!==t&&null!==t}var o=function(t,e,i){this.parentDiv=t,this.parameters=i,this.menuItemDiv=null,this.isOpen=null,this.openCloseImage=null,this.contentDiv=null,this.Initialize(e)};o.prototype.Initialize=function(e){var i,o;if((this.menuItemDiv=t("<div>").addClass("menuitem").appendTo(this.parentDiv),n(this.parameters))&&(n(this.parameters.id)&&this.menuItemDiv.attr("id",this.parameters.id),n(this.parameters.openCloseButton)&&this.AddOpenCloseButton(),n(this.parameters.userButtons)))for(i=0;i<this.parameters.userButtons.length;i++)o=this.parameters.userButtons[i],this.AddUserButton(o);var s=t("<div>").addClass("menuitem").html(e).attr("title",e).appendTo(this.menuItemDiv);n(this.parameters)&&n(this.parameters.openCloseButton)&&s.css("cursor","pointer")},o.prototype.AddSubItem=function(t,e){return new o(this.contentDiv,t,e)},o.prototype.GetContentDiv=function(){return this.contentDiv},o.prototype.AddOpenCloseButton=function(){var e=this;this.isOpen=!1,this.contentDiv=t("<div>").addClass("menuitemcontent").hide().appendTo(this.parentDiv),this.openCloseImage=t("<img>").addClass("menubutton").attr("title",this.parameters.openCloseButton.title).appendTo(this.menuItemDiv),this.openCloseImage.attr("src","images/closed.png"),this.menuItemDiv.click(function(){e.SetOpen(!e.isOpen)})},o.prototype.AddUserButton=function(e){var i=t("<img>").addClass("menubutton").attr("title",e.title).appendTo(this.menuItemDiv);n(e.id)&&i.attr("id",e.id),n(e.onCreate)&&e.onCreate(i,e.userData),(n(e.onClick)||n(e.onCtrlClick))&&i.click(function(t){t.stopPropagation(),t.ctrlKey&&n(e.onCtrlClick)?e.onCtrlClick(i,e.userData):n(e.onClick)&&e.onClick(i,e.userData)})},o.prototype.SetOpen=function(t){this.isOpen=t,this.isOpen?(n(this.parameters.openCloseButton.onOpen)&&this.parameters.openCloseButton.onOpen(this.contentDiv,this.parameters.openCloseButton.userData),this.contentDiv.show(),this.openCloseImage.attr("src","images/opened.png")):(n(this.parameters.openCloseButton.onClose)&&this.parameters.openCloseButton.onClose(this.contentDiv,this.parameters.openCloseButton.userData),this.contentDiv.hide(),this.openCloseImage.attr("src","images/closed.png"))},o.prototype.Highlight=function(t){t?this.menuItemDiv.addClass("highlighted"):this.menuItemDiv.removeClass("highlighted")},o.prototype.IsHighlighted=function(){return this.menuItemDiv.hasClass("highlighted")};var s=function(t){this.parentDiv=t,this.parentDiv.empty()};return s.prototype.AddGroup=function(t,e){return new o(this.parentDiv,t,e)},s}),t("skylark-online3dviewer/ImporterViewer",["skylark-threejs","skylark-jsmodeler"],function(t,e){e.THREE=t;var i=function(){this.viewer=null,this.jsonData=null};return i.prototype.Init=function(t){this.viewer=new e.ThreeViewer;var i=document.getElementById(t);return!!this.viewer.Start(i,{cameraEyePosition:[8,-6,4],cameraCenterPosition:[0,0,0],cameraUpVector:[0,0,1]})&&(this.viewer.navigation.SetNearDistanceLimit(.1),this.viewer.navigation.SetFarDistanceLimit(1e5),this.viewer.SetClearColor(14540253),this.viewer.Draw(),!0)},i.prototype.GetJsonData=function(){return this.jsonData},i.prototype.SetJsonData=function(t){this.jsonData=t},i.prototype.RemoveMeshes=function(){this.viewer.RemoveMeshes()},i.prototype.ShowAllMeshes=function(t){this.RemoveMeshes();var i=this,n=0,o={onStart:function(e){t.onStart(e),i.viewer.EnableDraw(!1)},onProgress:function(e,o){for(;n<o.length;)i.viewer.AddMesh(o[n]),n+=1;t.onProgress(e)},onFinish:function(e){i.AdjustClippingPlanes(50),i.FitInWindow(),i.viewer.EnableDraw(!0),i.viewer.Draw(),t.onFinish(e)}};e.ConvertJSONDataToThreeMeshes(this.jsonData,this.Draw.bind(this),o)},i.prototype.GetMeshesUnderPosition=function(e,i){var n,o=this.viewer.GetObjectsUnderPosition(e,i),s=[];for(n=0;n<o.length;n++)o[n].object instanceof t.Mesh&&s.push(o[n].object);return s},i.prototype.ShowMesh=function(e,i){this.viewer.scene.traverse(function(n){n instanceof t.Mesh&&n.originalJsonMeshIndex==e&&(n.visible=!!i)})},i.prototype.GetMeshesByMaterial=function(e){var i=[];return this.viewer.scene.traverse(function(n){n instanceof t.Mesh&&n.originalJsonMaterialIndex==e&&(0!==i.length&&i[i.length-1]==n.originalJsonMeshIndex||i.push(n.originalJsonMeshIndex))}),i},i.prototype.HighlightMesh=function(e,i){this.viewer.scene.traverse(function(n){n instanceof t.Mesh&&n.originalJsonMeshIndex==e&&(i?n.material.emissive.setHex(5592405):n.material.emissive.setHex(0))})},i.prototype.FitInWindow=function(){this.viewer.FitInWindow()},i.prototype.FitMeshInWindow=function(e){var i=[];this.viewer.scene.traverse(function(n){n instanceof t.Mesh&&n.originalJsonMeshIndex==e&&i.push(n)}),this.viewer.FitMeshesInWindow(i)},i.prototype.FitMeshesInWindow=function(e){var i=[];this.viewer.scene.traverse(function(n){n instanceof t.Mesh&&-1!=e.indexOf(n.originalJsonMeshIndex)&&i.push(n)}),this.viewer.FitMeshesInWindow(i)},i.prototype.AdjustClippingPlanes=function(){this.viewer.MeshCount()>0&&this.viewer.AdjustClippingPlanes(50)},i.prototype.SetFixUp=function(){this.viewer.navigation.EnableFixUp(!this.viewer.navigation.cameraFixUp)},i.prototype.SetNamedView=function(t){var i,n,o;if("z"==t)i=new e.Coord(1,0,0),n=new e.Coord(0,0,0),o=new e.Coord(0,0,1);else if("-z"==t)i=new e.Coord(-1,0,0),n=new e.Coord(0,0,0),o=new e.Coord(0,0,-1);else if("y"==t)i=new e.Coord(1,0,0),n=new e.Coord(0,0,0),o=new e.Coord(0,1,0);else if("-y"==t)i=new e.Coord(-1,0,0),n=new e.Coord(0,0,0),o=new e.Coord(0,-1,0);else if("x"==t)i=new e.Coord(0,1,0),n=new e.Coord(0,0,0),o=new e.Coord(1,0,0);else{if("-x"!=t)return;i=new e.Coord(0,-1,0),n=new e.Coord(0,0,0),o=new e.Coord(-1,0,0)}this.viewer.cameraMove.Set(i,n,o),this.viewer.FitInWindow()},i.prototype.Draw=function(){this.viewer.Draw()},i}),t("skylark-online3dviewer/ImporterApp",["skylark-jquery","skylark-jsmodeler","./InfoTable","./FloatingControl","./FloatingDialog","./ExtensionInterface","./ExtensionButtons","./ImporterProgressBar","./ImporterButtons","./ImporterMenu","./ImporterViewer"],function(t,e,i,n,o,s,r,a,l,h,d){var u=function(){this.canvas=null,this.viewer=null,this.fileNames=null,this.inGenerate=!1,this.meshesGroup=null,this.materialMenuItems=null,this.meshMenuItems=null,this.extensions=[],this.importerButtons=null,this.extensionButtons=null,this.introControl=null,this.floatingDialog=null,this.isMobile=null,this.readyForTest=null};return u.prototype.Init=function(){if(e.IsWebGLEnabled()&&e.IsFileApiEnabled()){var i=this,s=t("#top");this.importerButtons=new l(s),this.importerButtons.AddLogo('Online 3D Viewer <span class="version">v 0.6.6</span>'),this.importerButtons.AddButton("images/openfile.png","Open File",function(){i.OpenFile()}),this.importerButtons.AddButton("images/fitinwindow.png","Fit In Window",function(){i.FitInWindow()}),this.importerButtons.AddToggleButton("images/fixup.png","images/fixupgray.png","Enable/Disable Fixed Up Vector",function(){i.SetFixUp()}),this.importerButtons.AddButton("images/top.png","Set Up Vector (Z)",function(){i.SetNamedView("z")}),this.importerButtons.AddButton("images/bottom.png","Set Up Vector (-Z)",function(){i.SetNamedView("-z")}),this.importerButtons.AddButton("images/front.png","Set Up Vector (Y)",function(){i.SetNamedView("y")}),this.importerButtons.AddButton("images/back.png","Set Up Vector (-Y)",function(){i.SetNamedView("-y")}),this.importerButtons.AddButton("images/left.png","Set Up Vector (X)",function(){i.SetNamedView("x")}),this.importerButtons.AddButton("images/right.png","Set Up Vector (-X)",function(){i.SetNamedView("-x")}),this.extensionButtons=new r(s),this.introControl=new n,this.floatingDialog=new o;var a=window.matchMedia("(max-device-width : 600px)");this.isMobile=a.matches,window.addEventListener("resize",this.Resize.bind(this),!1),this.Resize();this.canvas=t("#modelcanvas"),this.RegisterCanvasClick(),this.viewer=new d,this.viewer.Init("modelcanvas"),window.addEventListener("dragover",this.DragOver.bind(this),!1),window.addEventListener("drop",this.Drop.bind(this),!1);var h=document.getElementById("file");h.addEventListener("change",this.FileSelected.bind(this),!1),window.onhashchange=this.LoadFilesFromHash.bind(this);var u=this.LoadFilesFromHash();u||this.isMobile||this.ShowIntroControl()}else{for(;document.body.lastChild;)document.body.removeChild(document.body.lastChild);var p=t("<div>").addClass("nosupport").appendTo(t("body"));p.html(['<div id="nosupport">',this.GetWelcomeText(),'<div class="nosupporterror">You need a browser which supports the following technologies: WebGL, WebGLRenderingContext, File, FileReader, FileList, Blob, URL.</div>',"</div>"].join(""))}},u.prototype.ClearReadyForTest=function(){null!==this.readyForTest&&(this.readyForTest.remove(),this.readyForTest=null)},u.prototype.SetReadyForTest=function(){this.readyForTest=t("<div>").attr("id","readyfortest").hide().appendTo(t("body"))},u.prototype.AddExtension=function(t){if(t.IsEnabled()){var e=new s(this);t.Init(e)}},u.prototype.ShowIntroControl=function(){var t=['<div class="importerdialog">',this.GetWelcomeText(),"</div>"].join("");this.introControl.Open({parent:this.canvas,text:t}),this.Resize()},u.prototype.HideIntroControl=function(){this.introControl.Close(),this.Resize()},u.prototype.GetWelcomeText=function(){var t=['<div class="welcometitle">Welcome to Online 3D Viewer!</div>','<div class="welcometext">Here you can view your local 3D models online. You have three ways to open a file. Use the open button above to select files, simply drag and drop files to this browser window, or define the url of the files as location hash.</div>','<div class="welcometextformats">Supported formats: 3ds, obj, stl, off.</div>','<div class="welcometext">Powered by <a target="_blank" href="https://github.com/mrdoob/three.js/">Three.js</a> and <a target="_blank" href="https://github.com/kovacsv/JSModeler">JSModeler</a>.</div>','<div class="welcometext"><a target="_blank" href="https://github.com/kovacsv/Online3DViewer"><img src="images/githublogo.png"/></a></div>'].join("");return t},u.prototype.Resize=function(){function t(t,e){t.height=e,t.style.height=e+"px"}var e,i,n=document.getElementById("top"),o=document.getElementById("left"),s=document.getElementById("modelcanvas"),r=document.body.clientHeight-n.offsetHeight;t(o,r),t(s,r),e=s,i=document.body.clientWidth-o.offsetWidth,e.width=i,e.style.width=i+"px",this.introControl.Resize(),this.floatingDialog.Resize()},u.prototype.JsonLoaded=function(t){this.Generate(t)},u.prototype.GenerateMenu=function(){function n(t,e,i){var n=t.AddGroup(e,{id:i,openCloseButton:{title:"Show/Hide "+e}});return n}function o(e,n,o,s,r){var a=o.AddSubItem(r.name,{openCloseButton:{title:"Show/Hide Information",onOpen:function(n,o){n.empty();var r=t("<div>").addClass("submenubuttons").appendTo(n),a=t("<img>").addClass("submenubutton").attr("src","images/highlightmesh.png").attr("title","Highlight Meshes By Material").appendTo(r);a.click(function(){e.HighlightMeshesByMaterial(s)});var l=t("<img>").addClass("submenubutton").attr("src","images/fitinwindowsmall.png").attr("title","Fit Meshes In Window By Material").appendTo(r);l.click(function(){e.FitMeshesByMaterialInWindow(s)});var h=new i(n);h.AddColorRow("Ambient",o.ambient),h.AddColorRow("Diffuse",o.diffuse),h.AddColorRow("Specular",o.specular),h.AddRow("Shininess",o.shininess.toFixed(2)),h.AddRow("Opacity",o.opacity.toFixed(2))},userData:r}});return a}function s(n,o,s,r,a){function l(e,i,n,o){var s=t("<div>").addClass("submenubuttons").appendTo(i),r=t("<img>").addClass("submenubutton").attr("src","images/fitinwindowsmall.png").attr("title","Fit Mesh In Window").appendTo(s);r.click(function(){e.FitMeshInWindow(o)});var a=t("<img>").addClass("submenubutton").attr("src","images/highlightmesh.png").attr("title","Highlight Mesh").appendTo(s);a.click(function(){e.HighlightMesh(o)});var l=t("<img>").addClass("submenubutton").attr("src","images/copytoclipboard.png").attr("title","Copy Mesh Name To Clipboard").appendTo(s);l.click(function(){var t,e;t=n,(e=document.createElement("input")).style.position="absolute",e.style.left="0",e.style.top="0",e.setAttribute("value",t),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)})}var h=null,d=s.AddSubItem(r.name,{id:"meshmenuitem-"+a.toString(),openCloseButton:{title:"Show/Hide Details",onOpen:function(t,o){t.empty(),l(n,t,o.name,a);var s,r,h=new i(t),d=new e.Coord(e.Inf,e.Inf,e.Inf),u=new e.Coord(-e.Inf,-e.Inf,-e.Inf);for(s=0;s<o.vertices.length;s+=3)r=new e.Coord(o.vertices[s],o.vertices[s+1],o.vertices[s+2]),d.x=e.Minimum(d.x,r.x),d.y=e.Minimum(d.y,r.y),d.z=e.Minimum(d.z,r.z),u.x=e.Maximum(u.x,r.x),u.y=e.Maximum(u.y,r.y),u.z=e.Maximum(u.z,r.z);h.AddRow("X Size",(u.x-d.x).toFixed(2)),h.AddRow("Y Size",(u.y-d.y).toFixed(2)),h.AddRow("Z Size",(u.z-d.z).toFixed(2));var p,c=0;for(s=0;s<o.triangles.length;s++)p=o.triangles[s],c+=p.parameters.length/9;h.AddRow("Vertex count",o.vertices.length/3),h.AddRow("Triangle count",c)},userData:r},userButtons:[{id:"showhidemesh-"+a,title:"Show/Hide Mesh",onCreate:function(t){t.attr("src","images/visible.png"),h=t},onClick:function(t,e){n.ShowHideMesh(e)},onCtrlClick:function(t,e){n.IsolateMesh(e)},userData:a}]});return d.isVisible=!0,d.visibleImage=h,d}var r,a=this.viewer.GetJsonData(),l=t("#menu"),d=new h(l),u=n(d,"Files","filesmenuitem");for(u.AddSubItem(this.fileNames.main),r=0;r<this.fileNames.requested.length;r++)u.AddSubItem(this.fileNames.requested[r]);if(this.fileNames.missing.length>0){var p=n(d,"Missing Files","missingfilesmenuitem");for(r=0;r<this.fileNames.missing.length;r++)p.AddSubItem(this.fileNames.missing[r])}var c=n(d,"Information","informationmenuitem");!function(t,e){var n,o,s,r,a=new i(t.GetContentDiv()),l=e.materials.length,h=0,d=0;for(n=0;n<e.meshes.length;n++)for(s=e.meshes[n],h+=s.vertices.length/3,o=0;o<s.triangles.length;o++)r=s.triangles[o],d+=r.parameters.length/9;a.AddRow("Material count",l),a.AddRow("Vertex count",h),a.AddRow("Triangle count",d)}(c,a),this.materialMenuItems=[];var m,v,f,g,w=n(d,"Materials","materialsmenuitem");for(r=0;r<a.materials.length;r++)m=a.materials[r],v=o(this,d,w,r,m),this.materialMenuItems.push(v);for(this.meshesGroup=n(d,"Meshes","meshesmenuitem"),this.meshMenuItems=[],r=0;r<a.meshes.length;r++)f=a.meshes[r],g=s(this,d,this.meshesGroup,f,r),this.meshMenuItems.push(g);this.Resize()},u.prototype.GenerateError=function(e){this.viewer.RemoveMeshes();var i=t("#menu");i.empty(),this.floatingDialog.Open({title:"Error",text:'<div class="importerdialog">'+e+"</div>",buttons:[{text:"ok",callback:function(t){t.Close()}}]})},u.prototype.Generate=function(t){function i(t,i,n){t.inGenerate=!0;var o={onStart:function(t){i.Init(t)},onProgress:function(t){i.Step(t+1)},onFinish:function(){t.GenerateMenu(),t.inGenerate=!1,t.SetReadyForTest()}};if(n){var s=t.viewer.GetJsonData();t.viewer.SetJsonData(e.MergeJsonDataMeshes(s))}t.viewer.ShowAllMeshes(o)}var n=this.viewer.GetJsonData();if(0===n.materials.length||0===n.meshes.length)return this.GenerateError("Failed to open file. Maybe something is wrong with your file."),void this.SetReadyForTest();var o=this;n.meshes.length>250?this.floatingDialog.Open({title:"Information",text:'<div class="importerdialog">The model contains a large number of meshes. It can cause performance problems. Would you like to merge meshes?</div>',buttons:[{text:"yes",callback:function(e){i(o,t,!0),e.Close()}},{text:"no",callback:function(e){i(o,t,!1),e.Close()}}]}):i(o,t,!1)},u.prototype.FitInWindow=function(){this.viewer.FitInWindow()},u.prototype.FitMeshInWindow=function(t){this.viewer.FitMeshInWindow(t)},u.prototype.FitMeshesByMaterialInWindow=function(t){var e=this.viewer.GetMeshesByMaterial(t);0!==e.length&&this.viewer.FitMeshesInWindow(e)},u.prototype.SetFixUp=function(){this.viewer.SetFixUp()},u.prototype.SetNamedView=function(t){this.viewer.SetNamedView(t)},u.prototype.SetView=function(t){this.viewer.SetView(t)},u.prototype.ShowHideMesh=function(t){var e=this.meshMenuItems[t];this.ShowHideMeshInternal(t,!e.isVisible),this.viewer.Draw()},u.prototype.IsolateMesh=function(t){var e,i=!0;if(this.meshMenuItems[t].isVisible){for(e=0;e<this.meshMenuItems.length;e++)if(this.meshMenuItems[e].isVisible&&e!==t){i=!1;break}}else i=!1;for(e=0;e<this.meshMenuItems.length;e++)i?this.ShowHideMeshInternal(e,!0):e==t?this.ShowHideMeshInternal(e,!0):this.ShowHideMeshInternal(e,!1);this.viewer.Draw()},u.prototype.ShowHideMeshInternal=function(t,e){var i=this.meshMenuItems[t];i.isVisible=e,i.visibleImage.attr("src",i.isVisible?"images/visible.png":"images/hidden.png"),this.viewer.ShowMesh(t,i.isVisible)},u.prototype.HighlightMeshInternal=function(t,e){var i=this.meshMenuItems[t];i.Highlight(e),this.viewer.HighlightMesh(t,e)},u.prototype.ProcessFiles=function(i,n){if(this.ClearReadyForTest(),this.HideIntroControl(),this.floatingDialog.Close(),!this.inGenerate){var o=i;if(0!==o.length){this.fileNames=null;var s=this,r=e.ConvertFileListToJsonData;n&&(r=e.ConvertURLListToJsonData);var l=t("#menu");l.empty(),n?l.html("Downloading files..."):l.html("Loading files..."),r(o,{onError:function(){s.GenerateError("No readable file found. You can open 3ds, obj, stl, and off files."),s.SetReadyForTest()},onReady:function(t,e){s.fileNames=t,s.viewer.SetJsonData(e),l.empty();var i=new a(l);s.JsonLoaded(i)}})}}},u.prototype.RegisterCanvasClick=function(){var e=this,i=null;this.canvas.mousedown(function(){i=[event.pageX,event.pageY]}),this.canvas.mouseup(function(n){var o=null==i||n.pageX!=i[0]||n.pageY!=i[1];if(!o){var s=n.pageX-t(this).offset().left,r=n.pageY-t(this).offset().top;e.OnCanvasClick(s,r)}i=null})},u.prototype.ScrollMeshIntoView=function(t){if(-1!=t){var e=this.meshMenuItems[t];e.menuItemDiv.get(0).scrollIntoView()}},u.prototype.HighlightMesh=function(t){var e,i;if(-1!=t)for(e=0;e<this.meshMenuItems.length;e++)i=this.meshMenuItems[e],!1,e==t&&(i.IsHighlighted()?this.HighlightMeshInternal(e,!1):this.HighlightMeshInternal(e,!0));else for(e=0;e<this.meshMenuItems.length;e++)(i=this.meshMenuItems[e]).IsHighlighted()&&this.HighlightMeshInternal(e,!1);this.viewer.Draw()},u.prototype.HighlightMeshesByMaterial=function(t){var e=this.viewer.GetMeshesByMaterial(t);if(0!==e.length){var i,n;for(this.HighlightMesh(-1),i=0;i<e.length;i++)n=e[i],this.meshMenuItems[n],this.HighlightMeshInternal(n,!0);this.meshesGroup.SetOpen(!0),this.ScrollMeshIntoView(e[0]),this.viewer.Draw()}},u.prototype.OnCanvasClick=function(t,e){if(null!=this.meshMenuItems){var i=this.viewer.GetMeshesUnderPosition(t,e),n=-1;i.length>0&&(n=i[0].originalJsonMeshIndex,this.meshesGroup.SetOpen(!0)),this.HighlightMesh(n),this.ScrollMeshIntoView(n)}},u.prototype.DragOver=function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},u.prototype.Drop=function(t){t.stopPropagation(),t.preventDefault(),this.ResetHash(),this.ProcessFiles(t.dataTransfer.files,!1)},u.prototype.FileSelected=function(t){t.stopPropagation(),t.preventDefault(),this.ResetHash(),this.ProcessFiles(t.target.files,!1)},u.prototype.OpenFile=function(){var t=document.getElementById("file");t.click()},u.prototype.ResetHash=function(){window.location.hash.length>1&&(window.location.hash="")},u.prototype.LoadFilesFromHash=function(){if(window.location.hash.length<2)return!1;var e=t("#file"),i=window.location.hash;if("#testmode"==i)return e.css("display",""),e.css("position","absolute"),e.css("right","10px"),e.css("bottom","10px"),!1;e.css("display","none");var i=i.substr(1,i.length-1),n=i.split(",");return this.ProcessFiles(n,!0),!0},u}),t("skylark-online3dviewer/main",["skylark-langx/skylark","./ImporterApp"],function(t,e){return t.attach("intg.jsmodeler.Online3dViewer",e)}),t("skylark-online3dviewer",["skylark-online3dviewer/main"],function(t){return t})}(i),!n){var r=require("skylark-langx/skylark");o?module.exports=r:e.skylarkjs=r}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-online3dviewer.js.map
