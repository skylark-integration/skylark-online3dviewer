{"version":3,"sources":["ImporterApp.js"],"names":["define","$","JSM","InfoTable","FloatingControl","FloatingDialog","ExtensionInterface","ExtensionButtons","ImporterProgressBar","ImporterButtons","ImporterMenu","ImporterViewer","ImporterApp","this","canvas","viewer","fileNames","inGenerate","meshesGroup","materialMenuItems","meshMenuItems","extensions","importerButtons","extensionButtons","introControl","floatingDialog","isMobile","readyForTest","prototype","Init","IsWebGLEnabled","IsFileApiEnabled","myThis","top","AddLogo","AddButton","OpenFile","FitInWindow","AddToggleButton","SetFixUp","SetNamedView","match","window","matchMedia","matches","addEventListener","Resize","bind","RegisterCanvasClick","DragOver","Drop","document","getElementById","FileSelected","onhashchange","LoadFilesFromHash","ShowIntroControl","body","lastChild","removeChild","addClass","appendTo","html","GetWelcomeText","join","ClearReadyForTest","remove","SetReadyForTest","attr","hide","AddExtension","extension","IsEnabled","extInterface","dialogText","Open","parent","text","HideIntroControl","Close","SetHeight","elem","value","height","style","left","clientHeight","offsetHeight","clientWidth","offsetWidth","width","JsonLoaded","progressBar","Generate","GenerateMenu","AddDefaultGroup","menu","name","id","AddGroup","openCloseButton","title","AddMaterial","importerApp","importerMenu","materialsGroup","materialIndex","material","AddSubItem","onOpen","contentDiv","empty","materialButtons","click","HighlightMeshesByMaterial","FitMeshesByMaterialInWindow","table","AddColorRow","ambient","diffuse","specular","AddRow","shininess","toFixed","opacity","userData","AddMesh","mesh","meshIndex","AddMeshButtons","meshName","meshButtons","FitMeshInWindow","HighlightMesh","input","createElement","position","setAttribute","appendChild","select","execCommand","visibleImage","meshMenuItem","toString","i","vertex","min","Coord","Inf","max","vertices","length","x","Minimum","y","z","Maximum","triangleCount","triangles","parameters","userButtons","onCreate","image","onClick","ShowHideMesh","onCtrlClick","IsolateMesh","isVisible","jsonData","GetJsonData","filesGroup","main","requested","missing","missingFilesGroup","infoGroup","j","infoTable","GetContentDiv","materialCount","materials","vertexCount","meshes","AddInformation","materialMenuItem","push","GenerateError","errorMessage","RemoveMeshes","buttons","callback","dialog","ShowMeshes","merge","environment","onStart","taskCount","onProgress","currentTask","Step","onFinish","SetJsonData","MergeJsonDataMeshes","ShowAllMeshes","meshIndices","GetMeshesByMaterial","FitMeshesInWindow","viewName","SetView","viewType","ShowHideMeshInternal","Draw","onlyThisVisible","ShowMesh","HighlightMeshInternal","highlight","Highlight","ProcessFiles","fileList","isUrl","userFiles","processorFunc","ConvertFileListToJsonData","ConvertURLListToJsonData","onError","onReady","mousePosition","mousedown","event","pageX","pageY","mouseup","offset","OnCanvasClick","ScrollMeshIntoView","menuItemDiv","get","scrollIntoView","menuItem","IsHighlighted","SetOpen","objects","GetMeshesUnderPosition","originalJsonMeshIndex","stopPropagation","preventDefault","dataTransfer","dropEffect","ResetHash","files","target","location","hash","fileInput","css","substr","split"],"mappings":"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","file":"../ImporterApp.js","sourcesContent":["define([\r\n\t\"skylark-jquery\",\r\n\t\"skylark-jsmodeler\",\r\n\t\"./InfoTable\",\r\n\t\"./FloatingControl\",\r\n\t\"./FloatingDialog\",\r\n\t\"./ExtensionInterface\",\r\n\t\"./ExtensionButtons\",\r\n\t\"./ImporterProgressBar\",\r\n\t\"./ImporterButtons\",\r\n\t\"./ImporterMenu\",\r\n\t\"./ImporterViewer\"\r\n],function($,JSM,InfoTable,FloatingControl,FloatingDialog,ExtensionInterface,ExtensionButtons, ImporterProgressBar,ImporterButtons, ImporterMenu,ImporterViewer){\r\n\tvar ImporterApp = function ()\r\n\t{\r\n\t\tthis.canvas = null;\r\n\t\tthis.viewer = null;\r\n\t\tthis.fileNames = null;\r\n\t\tthis.inGenerate = false;\r\n\t\tthis.meshesGroup = null;\r\n\t\tthis.materialMenuItems = null;\r\n\t\tthis.meshMenuItems = null;\r\n\t\tthis.extensions = [];\r\n\t\tthis.importerButtons = null;\r\n\t\tthis.extensionButtons = null;\r\n\t\tthis.introControl = null;\r\n\t\tthis.floatingDialog = null;\r\n\t\tthis.isMobile = null;\r\n\t\tthis.readyForTest = null;\r\n\t};\r\n\r\n\tImporterApp.prototype.Init = function ()\r\n\t{\r\n\t\tif (!JSM.IsWebGLEnabled () || !JSM.IsFileApiEnabled ()) {\r\n\t\t\twhile (document.body.lastChild) {\r\n\t\t\t\tdocument.body.removeChild (document.body.lastChild);\r\n\t\t\t}\r\n\r\n\t\t\tvar div = $('<div>').addClass ('nosupport').appendTo ($('body'));\r\n\t\t\tdiv.html ([\r\n\t\t\t\t'<div id=\"nosupport\">',\r\n\t\t\t\tthis.GetWelcomeText (),\r\n\t\t\t\t'<div class=\"nosupporterror\">You need a browser which supports the following technologies: WebGL, WebGLRenderingContext, File, FileReader, FileList, Blob, URL.</div>',\r\n\t\t\t\t'</div>'\r\n\t\t\t].join (''));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar myThis = this;\r\n\t\tvar top = $('#top');\r\n\t\tthis.importerButtons = new ImporterButtons (top);\r\n\t\tthis.importerButtons.AddLogo ('Online 3D Viewer <span class=\"version\">v 0.6.6</span>');\r\n\t\tthis.importerButtons.AddButton ('images/openfile.png', 'Open File', function () { myThis.OpenFile (); });\r\n\t\tthis.importerButtons.AddButton ('images/fitinwindow.png', 'Fit In Window', function () { myThis.FitInWindow (); });\r\n\t\tthis.importerButtons.AddToggleButton ('images/fixup.png', 'images/fixupgray.png', 'Enable/Disable Fixed Up Vector', function () { myThis.SetFixUp (); });\r\n\t\tthis.importerButtons.AddButton ('images/top.png', 'Set Up Vector (Z)', function () { myThis.SetNamedView ('z'); });\r\n\t\tthis.importerButtons.AddButton ('images/bottom.png', 'Set Up Vector (-Z)', function () { myThis.SetNamedView ('-z'); });\r\n\t\tthis.importerButtons.AddButton ('images/front.png', 'Set Up Vector (Y)', function () { myThis.SetNamedView ('y'); });\r\n\t\tthis.importerButtons.AddButton ('images/back.png', 'Set Up Vector (-Y)', function () { myThis.SetNamedView ('-y'); });\r\n\t\tthis.importerButtons.AddButton ('images/left.png', 'Set Up Vector (X)', function () { myThis.SetNamedView ('x'); });\r\n\t\tthis.importerButtons.AddButton ('images/right.png', 'Set Up Vector (-X)', function () { myThis.SetNamedView ('-x'); });\r\n\t\t\r\n\t\tthis.extensionButtons = new ExtensionButtons (top);\r\n\t\tthis.introControl = new FloatingControl ();\r\n\t\tthis.floatingDialog = new FloatingDialog ();\r\n\t\t\r\n\t\tvar match = window.matchMedia ('(max-device-width : 600px)');\r\n\t\tthis.isMobile = match.matches;\r\n\r\n\t\twindow.addEventListener ('resize', this.Resize.bind (this), false);\r\n\t\tthis.Resize ();\r\n\r\n\t\tvar canvasName = 'modelcanvas';\r\n\t\tthis.canvas = $('#' + canvasName);\r\n\t\tthis.RegisterCanvasClick ();\r\n\t\tthis.viewer = new ImporterViewer ();\r\n\t\tthis.viewer.Init (canvasName);\r\n\r\n\t\twindow.addEventListener ('dragover', this.DragOver.bind (this), false);\r\n\t\twindow.addEventListener ('drop', this.Drop.bind (this), false);\r\n\t\t\r\n\t\tvar fileInput = document.getElementById ('file');\r\n\t\tfileInput.addEventListener ('change', this.FileSelected.bind (this), false);\r\n\t\t\r\n\t\twindow.onhashchange = this.LoadFilesFromHash.bind (this);\r\n\t\tvar hasHashModel = this.LoadFilesFromHash ();\r\n\t\tif (!hasHashModel && !this.isMobile) {\r\n\t\t\tthis.ShowIntroControl ();\r\n\t\t}\r\n\t};\r\n\r\n\tImporterApp.prototype.ClearReadyForTest = function ()\r\n\t{\r\n\t\tif (this.readyForTest !== null) {\r\n\t\t\tthis.readyForTest.remove ();\r\n\t\t\tthis.readyForTest = null;\r\n\t\t}\r\n\t};\r\n\r\n\tImporterApp.prototype.SetReadyForTest = function ()\r\n\t{\r\n\t\tthis.readyForTest = $('<div>').attr ('id', 'readyfortest').hide ().appendTo ($('body'));\r\n\t};\r\n\r\n\tImporterApp.prototype.AddExtension = function (extension)\r\n\t{\r\n\t\tif (!extension.IsEnabled ()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar extInterface = new ExtensionInterface (this);\r\n\t\textension.Init (extInterface);\r\n\t};\r\n\r\n\tImporterApp.prototype.ShowIntroControl = function ()\r\n\t{\r\n\t\tvar dialogText = [\r\n\t\t\t'<div class=\"importerdialog\">',\r\n\t\t\tthis.GetWelcomeText (),\r\n\t\t\t'</div>',\r\n\t\t].join ('');\r\n\t\tthis.introControl.Open ({\r\n\t\t\tparent : this.canvas,\r\n\t\t\ttext : dialogText\r\n\t\t});\r\n\t\tthis.Resize ();\r\n\t};\r\n\r\n\tImporterApp.prototype.HideIntroControl = function ()\r\n\t{\r\n\t\tthis.introControl.Close ();\r\n\t\tthis.Resize ();\r\n\t};\r\n\r\n\tImporterApp.prototype.GetWelcomeText = function ()\r\n\t{\r\n\t\tvar welcomeText = [\r\n\t\t\t'<div class=\"welcometitle\">Welcome to Online 3D Viewer!</div>',\r\n\t\t\t'<div class=\"welcometext\">Here you can view your local 3D models online. You have three ways to open a file. Use the open button above to select files, simply drag and drop files to this browser window, or define the url of the files as location hash.</div>',\r\n\t\t\t'<div class=\"welcometextformats\">Supported formats: 3ds, obj, stl, off.</div>',\r\n\t\t\t'<div class=\"welcometext\">Powered by <a target=\"_blank\" href=\"https://github.com/mrdoob/three.js/\">Three.js</a> and <a target=\"_blank\" href=\"https://github.com/kovacsv/JSModeler\">JSModeler</a>.</div>',\r\n\t\t\t'<div class=\"welcometext\"><a target=\"_blank\" href=\"https://github.com/kovacsv/Online3DViewer\"><img src=\"images/githublogo.png\"/></a></div>',\r\n\t\t].join ('');\r\n\t\treturn welcomeText;\r\n\t};\r\n\r\n\tImporterApp.prototype.Resize = function ()\r\n\t{\r\n\t\tfunction SetWidth (elem, value)\r\n\t\t{\r\n\t\t\telem.width = value;\r\n\t\t\telem.style.width = value + 'px';\r\n\t\t}\r\n\r\n\t\tfunction SetHeight (elem, value)\r\n\t\t{\r\n\t\t\telem.height = value;\r\n\t\t\telem.style.height = value + 'px';\r\n\t\t}\r\n\r\n\t\tvar top = document.getElementById ('top');\r\n\t\tvar left = document.getElementById ('left');\r\n\t\tvar canvas = document.getElementById ('modelcanvas');\r\n\t\tvar height = document.body.clientHeight - top.offsetHeight;\r\n\r\n\t\tSetHeight (left, height);\r\n\t\tSetHeight (canvas, height);\r\n\t\tSetWidth (canvas, document.body.clientWidth - left.offsetWidth);\r\n\t\t\r\n\t\tthis.introControl.Resize ();\r\n\t\tthis.floatingDialog.Resize ();\r\n\t};\r\n\r\n\tImporterApp.prototype.JsonLoaded = function (progressBar)\r\n\t{\r\n\t\tthis.Generate (progressBar);\r\n\t};\r\n\r\n\tImporterApp.prototype.GenerateMenu = function ()\r\n\t{\r\n\t\tfunction AddDefaultGroup (menu, name, id)\r\n\t\t{\r\n\t\t\tvar group = menu.AddGroup (name, {\r\n\t\t\t\tid : id,\r\n\t\t\t\topenCloseButton : {\r\n\t\t\t\t\ttitle : 'Show/Hide ' + name\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn group;\r\n\t\t}\r\n\r\n\t\tfunction AddInformation (infoGroup, jsonData)\r\n\t\t{\r\n\t\t\tvar infoTable = new InfoTable (infoGroup.GetContentDiv ());\r\n\r\n\t\t\tvar materialCount = jsonData.materials.length;\r\n\t\t\tvar vertexCount = 0;\r\n\t\t\tvar triangleCount = 0;\r\n\t\t\t\r\n\t\t\tvar i, j, mesh, triangles;\r\n\t\t\tfor (i = 0; i < jsonData.meshes.length; i++) {\r\n\t\t\t\tmesh = jsonData.meshes[i];\r\n\t\t\t\tvertexCount += mesh.vertices.length / 3;\r\n\t\t\t\tfor (j = 0; j < mesh.triangles.length; j++) {\r\n\t\t\t\t\ttriangles = mesh.triangles[j];\r\n\t\t\t\t\ttriangleCount += triangles.parameters.length / 9;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\r\n\t\t\tinfoTable.AddRow ('Material count', materialCount);\t\r\n\t\t\tinfoTable.AddRow ('Vertex count', vertexCount);\t\r\n\t\t\tinfoTable.AddRow ('Triangle count', triangleCount);\t\r\n\t\t}\r\n\t\t\r\n\t\tfunction AddMaterial (importerApp, importerMenu, materialsGroup, materialIndex, material)\r\n\t\t{\r\n\t\t\tvar materialMenuItem = materialsGroup.AddSubItem (material.name, {\r\n\t\t\t\topenCloseButton : {\r\n\t\t\t\t\ttitle : 'Show/Hide Information',\r\n\t\t\t\t\tonOpen : function (contentDiv, material) {\r\n\t\t\t\t\t\tcontentDiv.empty ();\r\n\t\t\t\t\t\tvar materialButtons = $('<div>').addClass ('submenubuttons').appendTo (contentDiv);\r\n\t\t\t\t\t\tvar highlightButton = $('<img>').addClass ('submenubutton').attr ('src', 'images/highlightmesh.png').attr ('title', 'Highlight Meshes By Material').appendTo (materialButtons);\r\n\t\t\t\t\t\thighlightButton.click (function () {\r\n\t\t\t\t\t\t\timporterApp.HighlightMeshesByMaterial (materialIndex);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvar fitInWindowButton = $('<img>').addClass ('submenubutton').attr ('src', 'images/fitinwindowsmall.png').attr ('title', 'Fit Meshes In Window By Material').appendTo (materialButtons);\r\n\t\t\t\t\t\tfitInWindowButton.click (function () {\r\n\t\t\t\t\t\t\timporterApp.FitMeshesByMaterialInWindow (materialIndex);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvar table = new InfoTable (contentDiv);\r\n\t\t\t\t\t\ttable.AddColorRow ('Ambient', material.ambient);\r\n\t\t\t\t\t\ttable.AddColorRow ('Diffuse', material.diffuse);\r\n\t\t\t\t\t\ttable.AddColorRow ('Specular', material.specular);\r\n\t\t\t\t\t\ttable.AddRow ('Shininess', material.shininess.toFixed (2));\r\n\t\t\t\t\t\ttable.AddRow ('Opacity', material.opacity.toFixed (2));\r\n\t\t\t\t\t},\r\n\t\t\t\t\tuserData : material\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn materialMenuItem;\r\n\t\t}\r\n\r\n\t\tfunction AddMesh (importerApp, importerMenu, meshesGroup, mesh, meshIndex)\r\n\t\t{\r\n\t\t\tfunction AddMeshButtons (importerApp, contentDiv, meshName, meshIndex)\r\n\t\t\t{\r\n\t\t\t\tfunction CopyToClipboard (text) {\r\n\t\t\t\t\tvar input = document.createElement ('input');\r\n\t\t\t\t\tinput.style.position = 'absolute';\r\n\t\t\t\t\tinput.style.left = '0';\r\n\t\t\t\t\tinput.style.top = '0';\r\n\t\t\t\t\tinput.setAttribute ('value', text);\r\n\t\t\t\t\tdocument.body.appendChild (input);\r\n\t\t\t\t\tinput.select ();\r\n\t\t\t\t\tdocument.execCommand ('copy');\r\n\t\t\t\t\tdocument.body.removeChild(input);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar meshButtons = $('<div>').addClass ('submenubuttons').appendTo (contentDiv);\r\n\t\t\t\tvar fitInWindowButton = $('<img>').addClass ('submenubutton').attr ('src', 'images/fitinwindowsmall.png').attr ('title', 'Fit Mesh In Window').appendTo (meshButtons);\r\n\t\t\t\tfitInWindowButton.click (function () {\r\n\t\t\t\t\timporterApp.FitMeshInWindow (meshIndex);\r\n\t\t\t\t});\r\n\t\t\t\tvar highlightButton = $('<img>').addClass ('submenubutton').attr ('src', 'images/highlightmesh.png').attr ('title', 'Highlight Mesh').appendTo (meshButtons);\r\n\t\t\t\thighlightButton.click (function () {\r\n\t\t\t\t\timporterApp.HighlightMesh (meshIndex);\r\n\t\t\t\t});\r\n\t\t\t\tvar copyNameToClipboardButton = $('<img>').addClass ('submenubutton').attr ('src', 'images/copytoclipboard.png').attr ('title', 'Copy Mesh Name To Clipboard').appendTo (meshButtons);\r\n\t\t\t\tcopyNameToClipboardButton.click (function () {\r\n\t\t\t\t\tCopyToClipboard (meshName);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar visibleImage = null;\r\n\t\t\tvar meshMenuItem = meshesGroup.AddSubItem (mesh.name, {\r\n\t\t\t\tid : 'meshmenuitem-' + meshIndex.toString (),\r\n\t\t\t\topenCloseButton : {\r\n\t\t\t\t\ttitle : 'Show/Hide Details',\r\n\t\t\t\t\tonOpen : function (contentDiv, mesh) {\r\n\t\t\t\t\t\tcontentDiv.empty ();\r\n\r\n\t\t\t\t\t\tAddMeshButtons (importerApp, contentDiv, mesh.name, meshIndex);\r\n\t\t\t\t\t\tvar table = new InfoTable (contentDiv);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar min = new JSM.Coord (JSM.Inf, JSM.Inf, JSM.Inf);\r\n\t\t\t\t\t\tvar max = new JSM.Coord (-JSM.Inf, -JSM.Inf, -JSM.Inf);\r\n\t\t\t\t\t\tvar i, vertex;\r\n\t\t\t\t\t\tfor (i = 0; i < mesh.vertices.length; i =  i + 3) {\r\n\t\t\t\t\t\t\tvertex = new JSM.Coord (mesh.vertices[i], mesh.vertices[i + 1], mesh.vertices[i + 2]);\r\n\t\t\t\t\t\t\tmin.x = JSM.Minimum (min.x, vertex.x);\r\n\t\t\t\t\t\t\tmin.y = JSM.Minimum (min.y, vertex.y);\r\n\t\t\t\t\t\t\tmin.z = JSM.Minimum (min.z, vertex.z);\r\n\t\t\t\t\t\t\tmax.x = JSM.Maximum (max.x, vertex.x);\r\n\t\t\t\t\t\t\tmax.y = JSM.Maximum (max.y, vertex.y);\r\n\t\t\t\t\t\t\tmax.z = JSM.Maximum (max.z, vertex.z);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttable.AddRow ('X Size', (max.x - min.x).toFixed (2));\r\n\t\t\t\t\t\ttable.AddRow ('Y Size', (max.y - min.y).toFixed (2));\r\n\t\t\t\t\t\ttable.AddRow ('Z Size', (max.z - min.z).toFixed (2));\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar triangleCount = 0;\r\n\t\t\t\t\t\tvar triangles;\r\n\t\t\t\t\t\tfor (i = 0; i < mesh.triangles.length; i++) {\r\n\t\t\t\t\t\t\ttriangles = mesh.triangles[i];\r\n\t\t\t\t\t\t\ttriangleCount += triangles.parameters.length / 9;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t\ttable.AddRow ('Vertex count', mesh.vertices.length / 3);\r\n\t\t\t\t\t\ttable.AddRow ('Triangle count', triangleCount);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tuserData : mesh\r\n\t\t\t\t},\r\n\t\t\t\tuserButtons : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tid : 'showhidemesh-' + meshIndex,\r\n\t\t\t\t\t\ttitle : 'Show/Hide Mesh',\r\n\t\t\t\t\t\tonCreate : function (image) {\r\n\t\t\t\t\t\t\timage.attr ('src', 'images/visible.png');\r\n\t\t\t\t\t\t\tvisibleImage = image;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonClick : function (image, meshIndex) {\r\n\t\t\t\t\t\t\timporterApp.ShowHideMesh (meshIndex);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonCtrlClick : function (image, meshIndex) {\r\n\t\t\t\t\t\t\timporterApp.IsolateMesh (meshIndex);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tuserData : meshIndex\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tmeshMenuItem.isVisible = true;\r\n\t\t\tmeshMenuItem.visibleImage = visibleImage;\r\n\t\t\treturn meshMenuItem;\r\n\t\t}\t\t\r\n\t\t\r\n\t\tvar jsonData = this.viewer.GetJsonData ();\r\n\t\tvar menu = $('#menu');\r\n\t\tvar importerMenu = new ImporterMenu (menu);\r\n\r\n\t\tvar filesGroup = AddDefaultGroup (importerMenu, 'Files', 'filesmenuitem');\r\n\t\tfilesGroup.AddSubItem (this.fileNames.main);\r\n\t\tvar i;\r\n\t\tfor (i = 0; i < this.fileNames.requested.length; i++) {\r\n\t\t\tfilesGroup.AddSubItem (this.fileNames.requested[i]);\r\n\t\t}\r\n\t\t\r\n\t\tif (this.fileNames.missing.length > 0) {\r\n\t\t\tvar missingFilesGroup = AddDefaultGroup (importerMenu, 'Missing Files', 'missingfilesmenuitem');\r\n\t\t\tfor (i = 0; i < this.fileNames.missing.length; i++) {\r\n\t\t\t\tmissingFilesGroup.AddSubItem (this.fileNames.missing[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar infoGroup = AddDefaultGroup (importerMenu, 'Information', 'informationmenuitem');\r\n\t\tAddInformation (infoGroup, jsonData);\r\n\t\t\r\n\t\tthis.materialMenuItems = [];\r\n\t\tvar materialsGroup = AddDefaultGroup (importerMenu, 'Materials', 'materialsmenuitem');\r\n\t\tvar material, materialMenuItem;\r\n\t\tfor (i = 0; i < jsonData.materials.length; i++) {\r\n\t\t\tmaterial = jsonData.materials[i];\r\n\t\t\tmaterialMenuItem = AddMaterial (this, importerMenu, materialsGroup, i, material);\r\n\t\t\tthis.materialMenuItems.push (materialMenuItem);\r\n\t\t}\r\n\t\t\r\n\t\tthis.meshesGroup = AddDefaultGroup (importerMenu, 'Meshes', 'meshesmenuitem');\r\n\t\tthis.meshMenuItems = [];\r\n\t\tvar mesh, meshMenuItem;\r\n\t\tfor (i = 0; i < jsonData.meshes.length; i++) {\r\n\t\t\tmesh = jsonData.meshes[i];\r\n\t\t\tmeshMenuItem = AddMesh (this, importerMenu, this.meshesGroup, mesh, i);\r\n\t\t\tthis.meshMenuItems.push (meshMenuItem);\r\n\t\t}\r\n\t\t\r\n\t\tthis.Resize ();\r\n\t};\r\n\r\n\tImporterApp.prototype.GenerateError = function (errorMessage)\r\n\t{\r\n\t\tthis.viewer.RemoveMeshes ();\r\n\t\tvar menu = $('#menu');\r\n\t\tmenu.empty ();\r\n\t\t\r\n\t\tthis.floatingDialog.Open ({\r\n\t\t\ttitle : 'Error',\r\n\t\t\ttext : '<div class=\"importerdialog\">' + errorMessage + '</div>',\r\n\t\t\tbuttons : [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext : 'ok',\r\n\t\t\t\t\tcallback : function (dialog) {\r\n\t\t\t\t\t\tdialog.Close ();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t});\t\r\n\t};\r\n\r\n\tImporterApp.prototype.Generate = function (progressBar)\r\n\t{\r\n\t\tfunction ShowMeshes (importerApp, progressBar, merge)\r\n\t\t{\r\n\t\t\timporterApp.inGenerate = true;\r\n\t\t\tvar environment = {\r\n\t\t\t\tonStart : function (taskCount) {\r\n\t\t\t\t\tprogressBar.Init (taskCount);\r\n\t\t\t\t},\r\n\t\t\t\tonProgress : function (currentTask) {\r\n\t\t\t\t\tprogressBar.Step (currentTask + 1);\r\n\t\t\t\t},\r\n\t\t\t\tonFinish : function () {\r\n\t\t\t\t\timporterApp.GenerateMenu ();\r\n\t\t\t\t\timporterApp.inGenerate = false;\r\n\t\t\t\t\timporterApp.SetReadyForTest ();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tif (merge) {\r\n\t\t\t\tvar jsonData = importerApp.viewer.GetJsonData ();\r\n\t\t\t\timporterApp.viewer.SetJsonData (JSM.MergeJsonDataMeshes (jsonData));\r\n\t\t\t}\r\n\t\t\timporterApp.viewer.ShowAllMeshes (environment);\r\n\t\t}\r\n\r\n\t\tvar jsonData = this.viewer.GetJsonData ();\r\n\t\tif (jsonData.materials.length === 0 || jsonData.meshes.length === 0) {\r\n\t\t\tthis.GenerateError ('Failed to open file. Maybe something is wrong with your file.');\r\n\t\t\tthis.SetReadyForTest ();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar myThis = this;\r\n\t\tif (jsonData.meshes.length > 250) {\r\n\t\t\tthis.floatingDialog.Open ({\r\n\t\t\t\ttitle : 'Information',\r\n\t\t\t\ttext : '<div class=\"importerdialog\">The model contains a large number of meshes. It can cause performance problems. Would you like to merge meshes?</div>',\r\n\t\t\t\tbuttons : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext : 'yes',\r\n\t\t\t\t\t\tcallback : function (dialog) {\r\n\t\t\t\t\t\t\tShowMeshes (myThis, progressBar, true);\r\n\t\t\t\t\t\t\tdialog.Close ();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext : 'no',\r\n\t\t\t\t\t\tcallback : function (dialog) {\r\n\t\t\t\t\t\t\tShowMeshes (myThis, progressBar, false);\r\n\t\t\t\t\t\t\tdialog.Close ();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t]\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tShowMeshes (myThis, progressBar, false);\r\n\t\t}\r\n\t};\r\n\r\n\tImporterApp.prototype.FitInWindow = function ()\r\n\t{\r\n\t\tthis.viewer.FitInWindow ();\r\n\t};\r\n\r\n\tImporterApp.prototype.FitMeshInWindow = function (meshIndex)\r\n\t{\r\n\t\tthis.viewer.FitMeshInWindow (meshIndex);\r\n\t};\r\n\r\n\tImporterApp.prototype.FitMeshesByMaterialInWindow = function (materialIndex)\r\n\t{\r\n\t\tvar meshIndices = this.viewer.GetMeshesByMaterial (materialIndex);\r\n\t\tif (meshIndices.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.viewer.FitMeshesInWindow (meshIndices);\r\n\t};\r\n\r\n\tImporterApp.prototype.SetFixUp = function ()\r\n\t{\r\n\t\tthis.viewer.SetFixUp ();\r\n\t};\r\n\r\n\tImporterApp.prototype.SetNamedView = function (viewName)\r\n\t{\r\n\t\tthis.viewer.SetNamedView (viewName);\r\n\t};\r\n\r\n\tImporterApp.prototype.SetView = function (viewType)\r\n\t{\r\n\t\tthis.viewer.SetView (viewType);\r\n\t};\r\n\r\n\tImporterApp.prototype.ShowHideMesh = function (meshIndex)\r\n\t{\r\n\t\tvar meshMenuItem = this.meshMenuItems[meshIndex];\r\n\t\tthis.ShowHideMeshInternal (meshIndex, !meshMenuItem.isVisible);\r\n\t\tthis.viewer.Draw ();\r\n\t};\r\n\r\n\tImporterApp.prototype.IsolateMesh = function (meshIndex)\r\n\t{\r\n\t\tvar i, meshMenuItem;\r\n\t\t\r\n\t\tvar onlyThisVisible = true;\r\n\t\tif (!this.meshMenuItems[meshIndex].isVisible) {\r\n\t\t\tonlyThisVisible = false;\r\n\t\t} else {\r\n\t\t\tfor (i = 0; i < this.meshMenuItems.length; i++) {\r\n\t\t\t\tmeshMenuItem = this.meshMenuItems[i];\r\n\t\t\t\tif (meshMenuItem.isVisible && i !== meshIndex) {\r\n\t\t\t\t\tonlyThisVisible = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar i;\r\n\t\tfor (i = 0; i < this.meshMenuItems.length; i++) {\r\n\t\t\tif (onlyThisVisible) {\r\n\t\t\t\tthis.ShowHideMeshInternal (i, true);\r\n\t\t\t} else {\r\n\t\t\t\tif (i == meshIndex) {\r\n\t\t\t\t\tthis.ShowHideMeshInternal (i, true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.ShowHideMeshInternal (i, false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.viewer.Draw ();\r\n\t};\r\n\r\n\tImporterApp.prototype.ShowHideMeshInternal = function (meshIndex, isVisible)\r\n\t{\r\n\t\tvar meshMenuItem = this.meshMenuItems[meshIndex];\r\n\t\tmeshMenuItem.isVisible = isVisible;\r\n\t\tmeshMenuItem.visibleImage.attr ('src', meshMenuItem.isVisible ? 'images/visible.png' : 'images/hidden.png');\r\n\t\tthis.viewer.ShowMesh (meshIndex, meshMenuItem.isVisible);\r\n\t};\r\n\r\n\tImporterApp.prototype.HighlightMeshInternal = function (meshIndex, highlight)\r\n\t{\r\n\t\tvar meshMenuItem = this.meshMenuItems[meshIndex];\r\n\t\tmeshMenuItem.Highlight (highlight);\r\n\t\tthis.viewer.HighlightMesh (meshIndex, highlight);\r\n\t};\r\n\r\n\tImporterApp.prototype.ProcessFiles = function (fileList, isUrl)\r\n\t{\r\n\t\tthis.ClearReadyForTest ();\r\n\t\tthis.HideIntroControl ();\r\n\t\tthis.floatingDialog.Close ();\r\n\t\tif (this.inGenerate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar userFiles = fileList;\r\n\t\tif (userFiles.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis.fileNames = null;\r\n\t\t\r\n\t\tvar myThis = this;\r\n\t\tvar processorFunc = JSM.ConvertFileListToJsonData;\r\n\t\tif (isUrl) {\r\n\t\t\tprocessorFunc = JSM.ConvertURLListToJsonData;\r\n\t\t}\r\n\r\n\t\tvar menu = $('#menu');\r\n\t\tmenu.empty ();\r\n\t\tif (isUrl) {\r\n\t\t\tmenu.html ('Downloading files...');\r\n\t\t} else {\r\n\t\t\tmenu.html ('Loading files...');\r\n\t\t}\r\n\t\t\r\n\t\tprocessorFunc (userFiles, {\r\n\t\t\tonError : function () {\r\n\t\t\t\tmyThis.GenerateError ('No readable file found. You can open 3ds, obj, stl, and off files.');\r\n\t\t\t\tmyThis.SetReadyForTest ();\r\n\t\t\t\treturn;\r\n\t\t\t},\r\n\t\t\tonReady : function (fileNames, jsonData) {\r\n\t\t\t\tmyThis.fileNames = fileNames;\r\n\t\t\t\tmyThis.viewer.SetJsonData (jsonData);\r\n\t\t\t\tmenu.empty ();\r\n\t\t\t\tvar progressBar = new ImporterProgressBar (menu);\r\n\t\t\t\tmyThis.JsonLoaded (progressBar);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tImporterApp.prototype.RegisterCanvasClick = function ()\r\n\t{\r\n\t\tvar myThis = this;\r\n\t\tvar mousePosition = null;\r\n\t\tthis.canvas.mousedown (function () {\r\n\t\t\tmousePosition = [event.pageX, event.pageY];\r\n\t\t});\r\n\t\tthis.canvas.mouseup (function (event) {\r\n\t\t\tvar mouseMoved = (mousePosition == null || event.pageX != mousePosition[0] || event.pageY != mousePosition[1]);\r\n\t\t\tif (!mouseMoved) {\r\n\t\t\t\tvar x = event.pageX - $(this).offset ().left;\r\n\t\t\t\tvar y = event.pageY - $(this).offset ().top;\r\n\t\t\t\tmyThis.OnCanvasClick (x, y);\r\n\t\t\t}\r\n\t\t\tmousePosition = null;\r\n\t\t});\r\n\t};\r\n\r\n\tImporterApp.prototype.ScrollMeshIntoView = function (meshIndex)\r\n\t{\r\n\t\tif (meshIndex == -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar menuItem = this.meshMenuItems[meshIndex];\r\n\t\tmenuItem.menuItemDiv.get (0).scrollIntoView ();\r\n\t};\r\n\r\n\tImporterApp.prototype.HighlightMesh = function (meshIndex)\r\n\t{\r\n\t\tvar i, menuItem, highlight;\r\n\t\tif (meshIndex != -1) {\r\n\t\t\tfor (i = 0; i < this.meshMenuItems.length; i++) {\r\n\t\t\t\tmenuItem = this.meshMenuItems[i];\r\n\t\t\t\thighlight = false;\r\n\t\t\t\tif (i == meshIndex) {\r\n\t\t\t\t\tif (!menuItem.IsHighlighted ()) {\r\n\t\t\t\t\t\tthis.HighlightMeshInternal (i, true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.HighlightMeshInternal (i, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (i = 0; i < this.meshMenuItems.length; i++) {\r\n\t\t\t\tmenuItem = this.meshMenuItems[i];\r\n\t\t\t\tif (menuItem.IsHighlighted ()) {\r\n\t\t\t\t\tthis.HighlightMeshInternal (i, false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.viewer.Draw ();\r\n\t};\r\n\r\n\tImporterApp.prototype.HighlightMeshesByMaterial = function (materialIndex)\r\n\t{\r\n\t\tvar meshIndices = this.viewer.GetMeshesByMaterial (materialIndex);\r\n\t\tif (meshIndices.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar i, meshIndex, meshMenuItem;\r\n\t\tthis.HighlightMesh (-1);\r\n\t\tfor (i = 0; i < meshIndices.length; i++) {\r\n\t\t\tmeshIndex = meshIndices[i];\r\n\t\t\tmeshMenuItem = this.meshMenuItems[meshIndex];\r\n\t\t\tthis.HighlightMeshInternal (meshIndex, true);\r\n\t\t}\r\n\r\n\t\tthis.meshesGroup.SetOpen (true);\r\n\t\tthis.ScrollMeshIntoView (meshIndices[0]);\r\n\t\tthis.viewer.Draw ();\r\n\t};\r\n\r\n\tImporterApp.prototype.OnCanvasClick = function (x, y)\r\n\t{\r\n\t\tif (this.meshMenuItems == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar objects = this.viewer.GetMeshesUnderPosition (x, y);\r\n\t\tvar meshIndex = -1;\r\n\t\tif (objects.length > 0) {\r\n\t\t\tmeshIndex = objects[0].originalJsonMeshIndex;\r\n\t\t\tthis.meshesGroup.SetOpen (true);\r\n\t\t}\r\n\t\t\r\n\t\tthis.HighlightMesh (meshIndex);\r\n\t\tthis.ScrollMeshIntoView (meshIndex);\r\n\t};\r\n\r\n\tImporterApp.prototype.DragOver = function (event)\r\n\t{\r\n\t\tevent.stopPropagation ();\r\n\t\tevent.preventDefault ();\r\n\t\tevent.dataTransfer.dropEffect = 'copy';\r\n\t};\r\n\r\n\tImporterApp.prototype.Drop = function (event)\r\n\t{\r\n\t\tevent.stopPropagation ();\r\n\t\tevent.preventDefault ();\r\n\t\tthis.ResetHash ();\r\n\t\tthis.ProcessFiles (event.dataTransfer.files, false);\r\n\t};\r\n\r\n\tImporterApp.prototype.FileSelected = function (event)\r\n\t{\r\n\t\tevent.stopPropagation ();\r\n\t\tevent.preventDefault ();\r\n\t\tthis.ResetHash ();\r\n\t\tthis.ProcessFiles (event.target.files, false);\r\n\t};\r\n\r\n\tImporterApp.prototype.OpenFile = function ()\r\n\t{\r\n\t\tvar fileInput = document.getElementById ('file');\r\n\t\tfileInput.click ();\r\n\t};\r\n\r\n\tImporterApp.prototype.ResetHash = function ()\r\n\t{\r\n\t\tif (window.location.hash.length > 1) {\r\n\t\t\twindow.location.hash = '';\r\n\t\t}\r\n\t};\r\n\r\n\tImporterApp.prototype.LoadFilesFromHash = function ()\r\n\t{\r\n\t\tif (window.location.hash.length < 2) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tvar fileInput = $('#file');\r\n\t\tvar hash = window.location.hash;\r\n\t\tif (hash == '#testmode') {\r\n\t\t\tfileInput.css ('display', '');\r\n\t\t\tfileInput.css ('position', 'absolute');\r\n\t\t\tfileInput.css ('right', '10px');\r\n\t\t\tfileInput.css ('bottom', '10px');\r\n\t\t\treturn false;\t\r\n\t\t}\r\n\t\t\r\n\t\tfileInput.css ('display', 'none');\r\n\t\tvar hash = hash.substr (1, hash.length - 1);\r\n\t\tvar fileList = hash.split (',');\r\n\t\tthis.ProcessFiles (fileList, true);\r\n\t\treturn true;\r\n\t};\r\n\r\n\treturn ImporterApp;\r\n});"]}