{"version":3,"sources":["ImporterViewer.js"],"names":["define","THREE","JSM","ImporterViewer","this","viewer","jsonData","prototype","Init","canvasName","ThreeViewer","canvas","document","getElementById","Start","cameraEyePosition","cameraCenterPosition","cameraUpVector","navigation","SetNearDistanceLimit","SetFarDistanceLimit","SetClearColor","Draw","GetJsonData","SetJsonData","RemoveMeshes","ShowAllMeshes","inEnvironment","myThis","currentMeshIndex","environment","onStart","taskCount","EnableDraw","onProgress","currentTask","meshes","length","AddMesh","onFinish","AdjustClippingPlanes","FitInWindow","ConvertJSONDataToThreeMeshes","bind","GetMeshesUnderPosition","x","y","i","objects","GetObjectsUnderPosition","object","Mesh","push","ShowMesh","index","show","scene","traverse","current","originalJsonMeshIndex","visible","GetMeshesByMaterial","materialIndex","meshIndices","originalJsonMaterialIndex","HighlightMesh","highlight","material","emissive","setHex","FitMeshInWindow","FitMeshesInWindow","indexOf","MeshCount","SetFixUp","EnableFixUp","cameraFixUp","SetNamedView","viewName","eye","center","up","Coord","cameraMove","Set"],"mappings":"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","file":"../ImporterViewer.js","sourcesContent":["define([\r\n\t\"skylark-threejs\",\r\n\t\"skylark-jsmodeler\"\r\n],function(THREE,JSM){\r\n\tJSM.THREE = THREE;\r\n\t\r\n\tvar ImporterViewer = function ()\r\n\t{\r\n\t\tthis.viewer = null;\r\n\t\tthis.jsonData = null;\r\n\t};\r\n\r\n\tImporterViewer.prototype.Init = function (canvasName)\r\n\t{\r\n\t\tvar viewerSettings = {\r\n\t\t\tcameraEyePosition : [8.0, -6.0, 4.0],\r\n\t\t\tcameraCenterPosition : [0.0, 0.0, 0.0],\r\n\t\t\tcameraUpVector : [0, 0, 1]\r\n\t\t};\r\n\r\n\t\tthis.viewer = new JSM.ThreeViewer ();\r\n\t\tvar canvas = document.getElementById (canvasName);\r\n\t\tif (!this.viewer.Start (canvas, viewerSettings)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis.viewer.navigation.SetNearDistanceLimit (0.1);\r\n\t\tthis.viewer.navigation.SetFarDistanceLimit (100000.0);\r\n\t\tthis.viewer.SetClearColor (0xdddddd);\r\n\t\tthis.viewer.Draw ();\r\n\t\t\r\n\t\treturn true;\r\n\t};\r\n\r\n\tImporterViewer.prototype.GetJsonData = function ()\r\n\t{\r\n\t\treturn this.jsonData;\r\n\t};\r\n\r\n\tImporterViewer.prototype.SetJsonData = function (jsonData)\r\n\t{\r\n\t\tthis.jsonData = jsonData;\r\n\t};\r\n\r\n\tImporterViewer.prototype.RemoveMeshes = function ()\r\n\t{\r\n\t\tthis.viewer.RemoveMeshes ();\r\n\t};\r\n\r\n\tImporterViewer.prototype.ShowAllMeshes = function (inEnvironment)\r\n\t{\r\n\t\tthis.RemoveMeshes ();\r\n\t\t\r\n\t\tvar myThis = this;\r\n\t\tvar currentMeshIndex = 0;\r\n\t\tvar environment = {\r\n\t\t\tonStart : function (taskCount/*, meshes*/) {\r\n\t\t\t\tinEnvironment.onStart (taskCount);\r\n\t\t\t\tmyThis.viewer.EnableDraw (false);\r\n\t\t\t},\r\n\t\t\tonProgress : function (currentTask, meshes) {\r\n\t\t\t\twhile (currentMeshIndex < meshes.length) {\r\n\t\t\t\t\tmyThis.viewer.AddMesh (meshes[currentMeshIndex]);\r\n\t\t\t\t\tcurrentMeshIndex = currentMeshIndex + 1;\r\n\t\t\t\t}\r\n\t\t\t\tinEnvironment.onProgress (currentTask);\r\n\t\t\t},\r\n\t\t\tonFinish : function (meshes) {\r\n\t\t\t\tmyThis.AdjustClippingPlanes (50.0);\r\n\t\t\t\tmyThis.FitInWindow ();\r\n\t\t\t\tmyThis.viewer.EnableDraw (true);\r\n\t\t\t\tmyThis.viewer.Draw ();\r\n\t\t\t\tinEnvironment.onFinish (meshes);\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tJSM.ConvertJSONDataToThreeMeshes (this.jsonData, this.Draw.bind (this), environment);\r\n\t};\r\n\r\n\tImporterViewer.prototype.GetMeshesUnderPosition = function (x, y)\r\n\t{\r\n\t\tvar objects = this.viewer.GetObjectsUnderPosition (x, y);\r\n\t\tvar meshes = [];\r\n\t\tvar i;\r\n\t\tfor (i = 0; i < objects.length; i++) {\r\n\t\t\tif (objects[i].object instanceof THREE.Mesh) {\r\n\t\t\t\tmeshes.push (objects[i].object);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn meshes;\r\n\t};\r\n\r\n\tImporterViewer.prototype.ShowMesh = function (index, show)\r\n\t{\r\n\t\tthis.viewer.scene.traverse (function (current) {\r\n\t\t\tif (current instanceof THREE.Mesh) {\r\n\t\t\t\tif (current.originalJsonMeshIndex == index) {\r\n\t\t\t\t\tif (show) {\r\n\t\t\t\t\t\tcurrent.visible = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcurrent.visible = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tImporterViewer.prototype.GetMeshesByMaterial = function (materialIndex)\r\n\t{\r\n\t\tvar meshIndices = [];\r\n\t\tthis.viewer.scene.traverse (function (current) {\r\n\t\t\tif (current instanceof THREE.Mesh) {\r\n\t\t\t\tif (current.originalJsonMaterialIndex == materialIndex) {\r\n\t\t\t\t\tif (meshIndices.length === 0 || meshIndices[meshIndices.length - 1] != current.originalJsonMeshIndex) {\r\n\t\t\t\t\t\tmeshIndices.push (current.originalJsonMeshIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn meshIndices;\r\n\t};\r\n\r\n\tImporterViewer.prototype.HighlightMesh = function (index, highlight)\r\n\t{\r\n\t\tthis.viewer.scene.traverse (function (current) {\r\n\t\t\tif (current instanceof THREE.Mesh) {\r\n\t\t\t\tif (current.originalJsonMeshIndex == index) {\r\n\t\t\t\t\tif (highlight) {\r\n\t\t\t\t\t\tcurrent.material.emissive.setHex (0x555555);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcurrent.material.emissive.setHex (0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tImporterViewer.prototype.FitInWindow = function ()\r\n\t{\r\n\t\tthis.viewer.FitInWindow ();\r\n\t};\r\n\r\n\tImporterViewer.prototype.FitMeshInWindow = function (index)\r\n\t{\r\n\t\tvar meshes = [];\r\n\t\tthis.viewer.scene.traverse (function (current) {\r\n\t\t\tif (current instanceof THREE.Mesh) {\r\n\t\t\t\tif (current.originalJsonMeshIndex == index) {\r\n\t\t\t\t\tmeshes.push (current);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.viewer.FitMeshesInWindow (meshes);\r\n\t};\r\n\r\n\tImporterViewer.prototype.FitMeshesInWindow = function (meshIndices)\r\n\t{\r\n\t\tvar meshes = [];\r\n\t\tthis.viewer.scene.traverse (function (current) {\r\n\t\t\tif (current instanceof THREE.Mesh) {\r\n\t\t\t\tif (meshIndices.indexOf (current.originalJsonMeshIndex) != -1) {\r\n\t\t\t\t\tmeshes.push (current);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.viewer.FitMeshesInWindow (meshes);\r\n\t};\r\n\r\n\tImporterViewer.prototype.AdjustClippingPlanes = function ()\r\n\t{\r\n\t\tif (this.viewer.MeshCount () > 0) {\r\n\t\t\tthis.viewer.AdjustClippingPlanes (50.0);\r\n\t\t}\r\n\t};\r\n\r\n\tImporterViewer.prototype.SetFixUp = function ()\r\n\t{\r\n\t\tthis.viewer.navigation.EnableFixUp (!this.viewer.navigation.cameraFixUp);\r\n\t};\r\n\r\n\tImporterViewer.prototype.SetNamedView = function (viewName)\r\n\t{\r\n\t\tvar eye, center, up;\r\n\t\tif (viewName == 'z') {\r\n\t\t\teye = new JSM.Coord (1.0, 0.0, 0.0);\r\n\t\t\tcenter = new JSM.Coord (0.0, 0.0, 0.0);\r\n\t\t\tup = new JSM.Coord (0.0, 0.0, 1.0);\r\n\t\t} else if (viewName == '-z') {\r\n\t\t\teye = new JSM.Coord (-1.0, 0.0, 0.0);\r\n\t\t\tcenter = new JSM.Coord (0.0, 0.0, 0.0);\r\n\t\t\tup = new JSM.Coord (0.0, 0.0, -1.0);\r\n\t\t} else if (viewName == 'y') {\r\n\t\t\teye = new JSM.Coord (1.0, 0.0, 0.0);\r\n\t\t\tcenter = new JSM.Coord (0.0, 0.0, 0.0);\r\n\t\t\tup = new JSM.Coord (0.0, 1.0, 0.0);\r\n\t\t} else if (viewName == '-y') {\r\n\t\t\teye = new JSM.Coord (-1.0, 0.0, 0.0);\r\n\t\t\tcenter = new JSM.Coord (0.0, 0.0, 0.0);\r\n\t\t\tup = new JSM.Coord (0.0, -1.0, 0.0);\r\n\t\t} else if (viewName == 'x') {\r\n\t\t\teye = new JSM.Coord (0.0, 1.0, 0.0);\r\n\t\t\tcenter = new JSM.Coord (0.0, 0.0, 0.0);\r\n\t\t\tup = new JSM.Coord (1.0, 0.0, 0.0);\r\n\t\t} else if (viewName == '-x') {\r\n\t\t\teye = new JSM.Coord (0.0, -1.0, 0.0);\r\n\t\t\tcenter = new JSM.Coord (0.0, 0.0, 0.0);\r\n\t\t\tup = new JSM.Coord (-1.0, 0.0, 0.0);\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.viewer.cameraMove.Set (eye, center, up);\r\n\t\tthis.viewer.FitInWindow ();\r\n\t};\r\n\r\n\tImporterViewer.prototype.Draw = function ()\r\n\t{\r\n\t\tthis.viewer.Draw ();\r\n\t};\r\n\r\n\treturn ImporterViewer;\r\n});\r\n"]}